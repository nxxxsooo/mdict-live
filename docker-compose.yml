version: '3.8'

services:
  mdict-live:
    build: .
    # image: tardivo/mdict-live:latest
    container_name: mdict-live
    restart: unless-stopped
    ports:
      - "5248:5248"
    volumes:
      # Map dictionaries and database (flask_mdict.db)
      - ./library:/app/content

      # Map configuration folder
      - ./config:/config

    # Override command to use the config file in the mapped folder
    command: [ "python", "app.py", "--config-file", "/config/flask_mdict.json" ]

    # Optional: set REDIS_URL to enable Valkey/Redis cache backend
    # Without this, the app uses in-memory LRU cache (no extra services needed)
    # environment:
    #   - REDIS_URL=redis://valkey:6379/0

  # Optional: Valkey cache backend (uncomment to enable)
  # Install valkey-py in the container: pip install valkey
  # valkey:
  #   image: valkey/valkey:8-alpine
  #   container_name: mdict-valkey
  #   restart: unless-stopped
  #   command: valkey-server --maxmemory 200mb --maxmemory-policy allkeys-lru --save ""
  #   # No port exposure needed â€” only mdict-live talks to it
